{"version":3,"sources":["../../../../../../../../libs/movie/data-access/node_modules/oblivious-set/dist/lib/index.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.now = exports.removeTooOldValues = exports.ObliviousSet = void 0;\n/**\n * this is a set which automatically forgets\n * a given entry when a new entry is set and the ttl\n * of the old one is over\n */\nvar ObliviousSet = /** @class */ (function () {\n    function ObliviousSet(ttl) {\n        this.ttl = ttl;\n        this.set = new Set();\n        this.timeMap = new Map();\n    }\n    ObliviousSet.prototype.has = function (value) {\n        return this.set.has(value);\n    };\n    ObliviousSet.prototype.add = function (value) {\n        var _this = this;\n        this.timeMap.set(value, now());\n        this.set.add(value);\n        /**\n         * When a new value is added,\n         * start the cleanup at the next tick\n         * to not block the cpu for more important stuff\n         * that might happen.\n         */\n        setTimeout(function () {\n            removeTooOldValues(_this);\n        }, 0);\n    };\n    ObliviousSet.prototype.clear = function () {\n        this.set.clear();\n        this.timeMap.clear();\n    };\n    return ObliviousSet;\n}());\nexports.ObliviousSet = ObliviousSet;\n/**\n * Removes all entries from the set\n * where the TTL has expired\n */\nfunction removeTooOldValues(obliviousSet) {\n    var olderThen = now() - obliviousSet.ttl;\n    var iterator = obliviousSet.set[Symbol.iterator]();\n    /**\n     * Because we can assume the new values are added at the bottom,\n     * we start from the top and stop as soon as we reach a non-too-old value.\n     */\n    while (true) {\n        var value = iterator.next().value;\n        if (!value) {\n            return; // no more elements\n        }\n        var time = obliviousSet.timeMap.get(value);\n        if (time < olderThen) {\n            obliviousSet.timeMap.delete(value);\n            obliviousSet.set.delete(value);\n        }\n        else {\n            // We reached a value that is not old enough\n            return;\n        }\n    }\n}\nexports.removeTooOldValues = removeTooOldValues;\nfunction now() {\n    return new Date().getTime();\n}\nexports.now = now;\n//# sourceMappingURL=index.js.map"],"names":["Object","defineProperty","exports","value","now","removeTooOldValues","ObliviousSet","ttl","set","Set","timeMap","Map","prototype","has","add","_this","setTimeout","clear","obliviousSet","olderThen","iterator","Symbol","next","time","get","delete","Date","getTime"],"mappings":"AAAA,CAAY;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,CAAY,aAAE,CAAC;IAACC,KAAK,EAAE,IAAI;AAAC,CAAC;AAC5DD,OAAO,CAACE,GAAG,GAAGF,OAAO,CAACG,kBAAkB,GAAGH,OAAO,CAACI,YAAY,GAAG,IAAI,CAAC,CAAC;AACxE,EAIG,AAJH;;;;CAIG,AAJH,EAIG,CACH,GAAG,CAACA,YAAY,GAAG,EAAa,AAAb,SAAa,AAAb,EAAa,CAAE,QAAQ,GAAI,CAAC;aAClCA,aAAY,CAACC,GAAG,EAAE,CAAC;QACxB,IAAI,CAACA,GAAG,GAAGA,GAAG;QACd,IAAI,CAACC,GAAG,GAAG,GAAG,CAACC,GAAG;QAClB,IAAI,CAACC,OAAO,GAAG,GAAG,CAACC,GAAG;IAC1B,CAAC;IACDL,aAAY,CAACM,SAAS,CAACC,GAAG,GAAG,QAAQ,CAAEV,KAAK,EAAE,CAAC;QAC3C,MAAM,CAAC,IAAI,CAACK,GAAG,CAACK,GAAG,CAACV,KAAK;IAC7B,CAAC;IACDG,aAAY,CAACM,SAAS,CAACE,GAAG,GAAG,QAAQ,CAAEX,KAAK,EAAE,CAAC;QAC3C,GAAG,CAACY,KAAK,GAAG,IAAI;QAChB,IAAI,CAACL,OAAO,CAACF,GAAG,CAACL,KAAK,EAAEC,GAAG;QAC3B,IAAI,CAACI,GAAG,CAACM,GAAG,CAACX,KAAK;QAClB,EAKG,AALH;;;;;SAKG,AALH,EAKG,CACHa,UAAU,CAAC,QAAQ,GAAI,CAAC;YACpBX,kBAAkB,CAACU,KAAK;QAC5B,CAAC,EAAE,CAAC;IACR,CAAC;IACDT,aAAY,CAACM,SAAS,CAACK,KAAK,GAAG,QAAQ,GAAI,CAAC;QACxC,IAAI,CAACT,GAAG,CAACS,KAAK;QACd,IAAI,CAACP,OAAO,CAACO,KAAK;IACtB,CAAC;IACD,MAAM,CAACX,aAAY;AACvB,CAAC;AACDJ,OAAO,CAACI,YAAY,GAAGA,YAAY;AACnC,EAGG,AAHH;;;CAGG,AAHH,EAGG,UACMD,kBAAkB,CAACa,YAAY,EAAE,CAAC;IACvC,GAAG,CAACC,SAAS,GAAGf,GAAG,KAAKc,YAAY,CAACX,GAAG;IACxC,GAAG,CAACa,QAAQ,GAAGF,YAAY,CAACV,GAAG,CAACa,MAAM,CAACD,QAAQ;IAC/C,EAGG,AAHH;;;KAGG,AAHH,EAGG,OACI,IAAI,CAAE,CAAC;QACV,GAAG,CAACjB,KAAK,GAAGiB,QAAQ,CAACE,IAAI,GAAGnB,KAAK;QACjC,EAAE,GAAGA,KAAK,EAAE,CAAC;YACT,MAAM,CAAE,CAAmB,AAAnB,EAAmB,AAAnB,iBAAmB;QAC/B,CAAC;QACD,GAAG,CAACoB,IAAI,GAAGL,YAAY,CAACR,OAAO,CAACc,GAAG,CAACrB,KAAK;QACzC,EAAE,EAAEoB,IAAI,GAAGJ,SAAS,EAAE,CAAC;YACnBD,YAAY,CAACR,OAAO,CAACe,MAAM,CAACtB,KAAK;YACjCe,YAAY,CAACV,GAAG,CAACiB,MAAM,CAACtB,KAAK;QACjC,CAAC,MACI,CAAC;YACF,EAA4C,AAA5C,0CAA4C;YAC5C,MAAM;QACV,CAAC;IACL,CAAC;AACL,CAAC;AACDD,OAAO,CAACG,kBAAkB,GAAGA,kBAAkB;SACtCD,GAAG,GAAG,CAAC;IACZ,MAAM,CAAC,GAAG,CAACsB,IAAI,GAAGC,OAAO;AAC7B,CAAC;AACDzB,OAAO,CAACE,GAAG,GAAGA,GAAG,CACjB,CAAiC,AAAjC,EAAiC,AAAjC,+BAAiC"}