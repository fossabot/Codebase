{"version":3,"sources":["../../../../../../../../../../libs/movie/data-access/node_modules/@supabase/realtime-js/dist/module/lib/push.js"],"sourcesContent":["import { DEFAULT_TIMEOUT } from '../lib/constants';\nexport default class Push {\n    /**\n     * Initializes the Push\n     *\n     * @param channel The Channel\n     * @param event The event, for example `\"phx_join\"`\n     * @param payload The payload, for example `{user_id: 123}`\n     * @param timeout The push timeout in milliseconds\n     */\n    constructor(channel, event, payload = {}, timeout = DEFAULT_TIMEOUT) {\n        this.channel = channel;\n        this.event = event;\n        this.payload = payload;\n        this.timeout = timeout;\n        this.sent = false;\n        this.timeoutTimer = undefined;\n        this.ref = '';\n        this.receivedResp = null;\n        this.recHooks = [];\n        this.refEvent = null;\n    }\n    resend(timeout) {\n        this.timeout = timeout;\n        this._cancelRefEvent();\n        this.ref = '';\n        this.refEvent = null;\n        this.receivedResp = null;\n        this.sent = false;\n        this.send();\n    }\n    send() {\n        if (this._hasReceived('timeout')) {\n            return;\n        }\n        this.startTimeout();\n        this.sent = true;\n        this.channel.socket.push({\n            topic: this.channel.topic,\n            event: this.event,\n            payload: this.payload,\n            ref: this.ref,\n        });\n    }\n    updatePayload(payload) {\n        this.payload = Object.assign(Object.assign({}, this.payload), payload);\n    }\n    receive(status, callback) {\n        var _a;\n        if (this._hasReceived(status)) {\n            callback((_a = this.receivedResp) === null || _a === void 0 ? void 0 : _a.response);\n        }\n        this.recHooks.push({ status, callback });\n        return this;\n    }\n    startTimeout() {\n        if (this.timeoutTimer) {\n            return;\n        }\n        this.ref = this.channel.socket.makeRef();\n        this.refEvent = this.channel.replyEventName(this.ref);\n        this.channel.on(this.refEvent, (payload) => {\n            this._cancelRefEvent();\n            this._cancelTimeout();\n            this.receivedResp = payload;\n            this._matchReceive(payload);\n        });\n        this.timeoutTimer = setTimeout(() => {\n            this.trigger('timeout', {});\n        }, this.timeout);\n    }\n    trigger(status, response) {\n        if (this.refEvent)\n            this.channel.trigger(this.refEvent, { status, response });\n    }\n    destroy() {\n        this._cancelRefEvent();\n        this._cancelTimeout();\n    }\n    _cancelRefEvent() {\n        if (!this.refEvent) {\n            return;\n        }\n        this.channel.off(this.refEvent);\n    }\n    _cancelTimeout() {\n        clearTimeout(this.timeoutTimer);\n        this.timeoutTimer = undefined;\n    }\n    _matchReceive({ status, response, }) {\n        this.recHooks\n            .filter((h) => h.status === status)\n            .forEach((h) => h.callback(response));\n    }\n    _hasReceived(status) {\n        return this.receivedResp && this.receivedResp.status === status;\n    }\n}\n//# sourceMappingURL=push.js.map"],"names":["Push","resend","timeout","_cancelRefEvent","ref","refEvent","receivedResp","sent","send","_hasReceived","startTimeout","channel","socket","push","topic","event","payload","updatePayload","Object","assign","receive","status","callback","_a","response","recHooks","timeoutTimer","makeRef","replyEventName","on","_cancelTimeout","_matchReceive","setTimeout","trigger","destroy","off","clearTimeout","undefined","filter","h","forEach","DEFAULT_TIMEOUT"],"mappings":"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"}