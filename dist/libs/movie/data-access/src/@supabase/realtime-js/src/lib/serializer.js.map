{"version":3,"sources":["../../../../../../../../../libs/movie/data-access/node_modules/@supabase/realtime-js/src/lib/serializer.ts"],"sourcesContent":["// This file draws heavily from https://github.com/phoenixframework/phoenix/commit/cf098e9cf7a44ee6479d31d911a97d3c7430c6fe\n// License: https://github.com/phoenixframework/phoenix/blob/master/LICENSE.md\n\nexport default class Serializer {\n  HEADER_LENGTH = 1\n\n  decode(rawPayload: ArrayBuffer | string, callback: Function) {\n    if (rawPayload.constructor === ArrayBuffer) {\n      return callback(this._binaryDecode(rawPayload))\n    }\n\n    if (typeof rawPayload === 'string') {\n      return callback(JSON.parse(rawPayload))\n    }\n\n    return callback({})\n  }\n\n  private _binaryDecode(buffer: ArrayBuffer) {\n    const view = new DataView(buffer)\n    const decoder = new TextDecoder()\n\n    return this._decodeBroadcast(buffer, view, decoder)\n  }\n\n  private _decodeBroadcast(\n    buffer: ArrayBuffer,\n    view: DataView,\n    decoder: TextDecoder\n  ): {\n    ref: null\n    topic: string\n    event: string\n    payload: object\n  } {\n    const topicSize = view.getUint8(1)\n    const eventSize = view.getUint8(2)\n    let offset = this.HEADER_LENGTH + 2\n    const topic = decoder.decode(buffer.slice(offset, offset + topicSize))\n    offset = offset + topicSize\n    const event = decoder.decode(buffer.slice(offset, offset + eventSize))\n    offset = offset + eventSize\n    const data = JSON.parse(\n      decoder.decode(buffer.slice(offset, buffer.byteLength))\n    )\n\n    return { ref: null, topic: topic, event: event, payload: data }\n  }\n}\n"],"names":["Serializer","decode","rawPayload","callback","constructor","ArrayBuffer","_binaryDecode","JSON","parse","buffer","view","DataView","decoder","TextDecoder","_decodeBroadcast","topicSize","getUint8","eventSize","offset","HEADER_LENGTH","topic","slice","event","data","byteLength","ref","payload"],"mappings":";;AAGe,GAAK,CAACA,UAAU,SAAVA,UAAU;IAG7BC,MAAM,CAACC,UAAgC,EAAEC,QAAkB,EAAE,CAAC;QAC5D,EAAE,EAAED,UAAU,CAACE,WAAW,KAAKC,WAAW,EAAE,CAAC;YAC3C,MAAM,CAACF,QAAQ,CAAC,IAAI,CAACG,aAAa,CAACJ,UAAU;QAC/C,CAAC;QAED,EAAE,EAAE,MAAM,CAACA,UAAU,KAAK,CAAQ,SAAE,CAAC;YACnC,MAAM,CAACC,QAAQ,CAACI,IAAI,CAACC,KAAK,CAACN,UAAU;QACvC,CAAC;QAED,MAAM,CAACC,QAAQ,CAAC,CAAC,CAAC;IACpB,CAAC;IAEOG,aAAa,CAACG,MAAmB,EAAE,CAAC;QAC1C,KAAK,CAACC,IAAI,GAAG,GAAG,CAACC,QAAQ,CAACF,MAAM;QAChC,KAAK,CAACG,OAAO,GAAG,GAAG,CAACC,WAAW;QAE/B,MAAM,CAAC,IAAI,CAACC,gBAAgB,CAACL,MAAM,EAAEC,IAAI,EAAEE,OAAO;IACpD,CAAC;IAEOE,gBAAgB,CACtBL,MAAmB,EACnBC,IAAc,EACdE,OAAoB,EAMpB,CAAC;QACD,KAAK,CAACG,SAAS,GAAGL,IAAI,CAACM,QAAQ,CAAC,CAAC;QACjC,KAAK,CAACC,SAAS,GAAGP,IAAI,CAACM,QAAQ,CAAC,CAAC;QACjC,GAAG,CAACE,MAAM,GAAG,IAAI,CAACC,aAAa,GAAG,CAAC;QACnC,KAAK,CAACC,KAAK,GAAGR,OAAO,CAACX,MAAM,CAACQ,MAAM,CAACY,KAAK,CAACH,MAAM,EAAEA,MAAM,GAAGH,SAAS;QACpEG,MAAM,GAAGA,MAAM,GAAGH,SAAS;QAC3B,KAAK,CAACO,KAAK,GAAGV,OAAO,CAACX,MAAM,CAACQ,MAAM,CAACY,KAAK,CAACH,MAAM,EAAEA,MAAM,GAAGD,SAAS;QACpEC,MAAM,GAAGA,MAAM,GAAGD,SAAS;QAC3B,KAAK,CAACM,IAAI,GAAGhB,IAAI,CAACC,KAAK,CACrBI,OAAO,CAACX,MAAM,CAACQ,MAAM,CAACY,KAAK,CAACH,MAAM,EAAET,MAAM,CAACe,UAAU;QAGvD,MAAM,CAAC,CAAC;YAACC,GAAG,EAAE,IAAI;YAAEL,KAAK,EAAEA,KAAK;YAAEE,KAAK,EAAEA,KAAK;YAAEI,OAAO,EAAEH,IAAI;QAAC,CAAC;IACjE,CAAC;;QA5CY,IA6Cd,CA5CCJ,aAAa,GAAG,CAAC;;;kBADEnB,UAAU"}