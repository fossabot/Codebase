{"version":3,"sources":["../../../../../../../libs/movie/data-access/node_modules/ext/promise/limit.js"],"sourcesContent":["\"use strict\";\n\nvar ensureNaturalNumber  = require(\"type/natural-number/ensure\")\n  , ensurePlainFunction  = require(\"type/plain-function/ensure\")\n  , ensure               = require(\"type/ensure\")\n  , defineFunctionLength = require(\"../lib/private/define-function-length\");\n\nmodule.exports = function (limit, callback) {\n\tlimit = ensure(\n\t\t[\"limit\", limit, ensureNaturalNumber, { min: 1 }],\n\t\t[\"callback\", callback, ensurePlainFunction]\n\t)[0];\n\n\tvar Promise = this, ongoingCount = 0, pending = [];\n\tvar onSuccess, onFailure;\n\n\tvar release = function () {\n\t\t--ongoingCount;\n\t\tif (ongoingCount >= limit) return;\n\t\tvar next = pending.shift();\n\t\tif (!next) return;\n\t\t++ongoingCount;\n\t\ttry {\n\t\t\tnext.resolve(\n\t\t\t\tPromise.resolve(callback.apply(next.context, next.arguments)).then(\n\t\t\t\t\tonSuccess, onFailure\n\t\t\t\t)\n\t\t\t);\n\t\t} catch (exception) {\n\t\t\trelease();\n\t\t\tnext.reject(exception);\n\t\t}\n\t};\n\n\tonSuccess = function (value) {\n\t\trelease();\n\t\treturn value;\n\t};\n\n\tonFailure = function (exception) {\n\t\trelease();\n\t\tthrow exception;\n\t};\n\n\treturn defineFunctionLength(callback.length, function () {\n\t\tif (ongoingCount >= limit) {\n\t\t\tvar context = this, args = arguments;\n\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\tpending.push({\n\t\t\t\t\tcontext: context,\n\t\t\t\t\targuments: args,\n\t\t\t\t\tresolve: resolve,\n\t\t\t\t\treject: reject\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\t++ongoingCount;\n\t\ttry {\n\t\t\treturn Promise.resolve(callback.apply(this, arguments)).then(onSuccess, onFailure);\n\t\t} catch (exception) { return onFailure(exception); }\n\t});\n};\n"],"names":["ensureNaturalNumber","require","ensurePlainFunction","ensure","defineFunctionLength","module","exports","limit","callback","min","Promise","ongoingCount","pending","onSuccess","onFailure","release","next","shift","resolve","apply","context","arguments","then","exception","reject","value","length","args","push"],"mappings":"AAAA,CAAY;AAEZ,GAAG,CAACA,mBAAmB,GAAIC,OAAO,CAAC,CAA4B,8BAC3DC,mBAAmB,GAAID,OAAO,CAAC,CAA4B,8BAC3DE,MAAM,GAAiBF,OAAO,CAAC,CAAa,eAC5CG,oBAAoB,GAAGH,OAAO,CAAC,CAAuC;AAE1EI,MAAM,CAACC,OAAO,GAAG,QAAQ,CAAEC,KAAK,EAAEC,QAAQ,EAAE,CAAC;IAC5CD,KAAK,GAAGJ,MAAM,CACb,CAAC;QAAA,CAAO;QAAEI,KAAK;QAAEP,mBAAmB;QAAE,CAAC;YAACS,GAAG,EAAE,CAAC;QAAC,CAAC;IAAA,CAAC,EACjD,CAAC;QAAA,CAAU;QAAED,QAAQ;QAAEN,mBAAmB;IAAA,CAAC,EAC1C,CAAC;IAEH,GAAG,CAACQ,OAAO,GAAG,IAAI,EAAEC,YAAY,GAAG,CAAC,EAAEC,OAAO,GAAG,CAAC,CAAC;IAClD,GAAG,CAACC,SAAS,EAAEC,SAAS;IAExB,GAAG,CAACC,OAAO,GAAG,QAAQ,GAAI,CAAC;UACxBJ,YAAY;QACd,EAAE,EAAEA,YAAY,IAAIJ,KAAK,EAAE,MAAM;QACjC,GAAG,CAACS,IAAI,GAAGJ,OAAO,CAACK,KAAK;QACxB,EAAE,GAAGD,IAAI,EAAE,MAAM;UACfL,YAAY;QACd,GAAG,CAAC,CAAC;YACJK,IAAI,CAACE,OAAO,CACXR,OAAO,CAACQ,OAAO,CAACV,QAAQ,CAACW,KAAK,CAACH,IAAI,CAACI,OAAO,EAAEJ,IAAI,CAACK,SAAS,GAAGC,IAAI,CACjET,SAAS,EAAEC,SAAS;QAGvB,CAAC,CAAC,KAAK,EAAES,SAAS,EAAE,CAAC;YACpBR,OAAO;YACPC,IAAI,CAACQ,MAAM,CAACD,SAAS;QACtB,CAAC;IACF,CAAC;IAEDV,SAAS,GAAG,QAAQ,CAAEY,KAAK,EAAE,CAAC;QAC7BV,OAAO;QACP,MAAM,CAACU,KAAK;IACb,CAAC;IAEDX,SAAS,GAAG,QAAQ,CAAES,SAAS,EAAE,CAAC;QACjCR,OAAO;QACP,KAAK,CAACQ,SAAS;IAChB,CAAC;IAED,MAAM,CAACnB,oBAAoB,CAACI,QAAQ,CAACkB,MAAM,EAAE,QAAQ,GAAI,CAAC;QACzD,EAAE,EAAEf,YAAY,IAAIJ,KAAK,EAAE,CAAC;YAC3B,GAAG,CAACa,OAAO,GAAG,IAAI,EAAEO,IAAI,GAAGN,SAAS;YACpC,MAAM,CAAC,GAAG,CAACX,OAAO,CAAC,QAAQ,CAAEQ,OAAO,EAAEM,MAAM,EAAE,CAAC;gBAC9CZ,OAAO,CAACgB,IAAI,CAAC,CAAC;oBACbR,OAAO,EAAEA,OAAO;oBAChBC,SAAS,EAAEM,IAAI;oBACfT,OAAO,EAAEA,OAAO;oBAChBM,MAAM,EAAEA,MAAM;gBACf,CAAC;YACF,CAAC;QACF,CAAC;UACCb,YAAY;QACd,GAAG,CAAC,CAAC;YACJ,MAAM,CAACD,OAAO,CAACQ,OAAO,CAACV,QAAQ,CAACW,KAAK,CAAC,IAAI,EAAEE,SAAS,GAAGC,IAAI,CAACT,SAAS,EAAEC,SAAS;QAClF,CAAC,CAAC,KAAK,EAAES,SAAS,EAAE,CAAC;YAAC,MAAM,CAACT,SAAS,CAACS,SAAS;QAAG,CAAC;IACrD,CAAC;AACF,CAAC"}