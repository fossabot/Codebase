{"version":3,"sources":["../../../../../../../../../libs/movie/data-access/node_modules/broadcast-channel/dist/es/methods/indexed-db.js"],"sourcesContent":["/**\n * this method uses indexeddb to store the messages\n * There is currently no observerAPI for idb\n * @link https://github.com/w3c/IndexedDB/issues/51\n */\nimport { sleep, randomInt, randomToken, microSeconds as micro, isNode } from '../util.js';\nexport var microSeconds = micro;\nimport { ObliviousSet } from 'oblivious-set';\nimport { fillOptionsWithDefaults } from '../options';\nvar DB_PREFIX = 'pubkey.broadcast-channel-0-';\nvar OBJECT_STORE_ID = 'messages';\nexport var type = 'idb';\nexport function getIdb() {\n  if (typeof indexedDB !== 'undefined') return indexedDB;\n\n  if (typeof window !== 'undefined') {\n    if (typeof window.mozIndexedDB !== 'undefined') return window.mozIndexedDB;\n    if (typeof window.webkitIndexedDB !== 'undefined') return window.webkitIndexedDB;\n    if (typeof window.msIndexedDB !== 'undefined') return window.msIndexedDB;\n  }\n\n  return false;\n}\nexport function createDatabase(channelName) {\n  var IndexedDB = getIdb(); // create table\n\n  var dbName = DB_PREFIX + channelName;\n  var openRequest = IndexedDB.open(dbName, 1);\n\n  openRequest.onupgradeneeded = function (ev) {\n    var db = ev.target.result;\n    db.createObjectStore(OBJECT_STORE_ID, {\n      keyPath: 'id',\n      autoIncrement: true\n    });\n  };\n\n  var dbPromise = new Promise(function (res, rej) {\n    openRequest.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    openRequest.onsuccess = function () {\n      res(openRequest.result);\n    };\n  });\n  return dbPromise;\n}\n/**\n * writes the new message to the database\n * so other readers can find it\n */\n\nexport function writeMessage(db, readerUuid, messageJson) {\n  var time = new Date().getTime();\n  var writeObject = {\n    uuid: readerUuid,\n    time: time,\n    data: messageJson\n  };\n  var transaction = db.transaction([OBJECT_STORE_ID], 'readwrite');\n  return new Promise(function (res, rej) {\n    transaction.oncomplete = function () {\n      return res();\n    };\n\n    transaction.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    var objectStore = transaction.objectStore(OBJECT_STORE_ID);\n    objectStore.add(writeObject);\n  });\n}\nexport function getAllMessages(db) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        ret.push(cursor.value); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n        cursor[\"continue\"]();\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function getMessagesHigherThan(db, lastCursorId) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n\n  function openCursor() {\n    // Occasionally Safari will fail on IDBKeyRange.bound, this\n    // catches that error, having it open the cursor to the first\n    // item. When it gets data it will advance to the desired key.\n    try {\n      var keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n      return objectStore.openCursor(keyRangeValue);\n    } catch (e) {\n      return objectStore.openCursor();\n    }\n  }\n\n  return new Promise(function (res) {\n    openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        if (cursor.value.id < lastCursorId + 1) {\n          cursor[\"continue\"](lastCursorId + 1);\n        } else {\n          ret.push(cursor.value);\n          cursor[\"continue\"]();\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function removeMessageById(db, id) {\n  var request = db.transaction([OBJECT_STORE_ID], 'readwrite').objectStore(OBJECT_STORE_ID)[\"delete\"](id);\n  return new Promise(function (res) {\n    request.onsuccess = function () {\n      return res();\n    };\n  });\n}\nexport function getOldMessages(db, ttl) {\n  var olderThen = new Date().getTime() - ttl;\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        var msgObk = cursor.value;\n\n        if (msgObk.time < olderThen) {\n          ret.push(msgObk); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n          cursor[\"continue\"]();\n        } else {\n          // no more old messages,\n          res(ret);\n          return;\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\nexport function cleanOldMessages(db, ttl) {\n  return getOldMessages(db, ttl).then(function (tooOld) {\n    return Promise.all(tooOld.map(function (msgObj) {\n      return removeMessageById(db, msgObj.id);\n    }));\n  });\n}\nexport function create(channelName, options) {\n  options = fillOptionsWithDefaults(options);\n  return createDatabase(channelName).then(function (db) {\n    var state = {\n      closed: false,\n      lastCursorId: 0,\n      channelName: channelName,\n      options: options,\n      uuid: randomToken(),\n\n      /**\n       * emittedMessagesIds\n       * contains all messages that have been emitted before\n       * @type {ObliviousSet}\n       */\n      eMIs: new ObliviousSet(options.idb.ttl * 2),\n      // ensures we do not read messages in parrallel\n      writeBlockPromise: Promise.resolve(),\n      messagesCallback: null,\n      readQueuePromises: [],\n      db: db\n    };\n    /**\n     * Handle abrupt closes that do not originate from db.close().\n     * This could happen, for example, if the underlying storage is\n     * removed or if the user clears the database in the browser's\n     * history preferences.\n     */\n\n    db.onclose = function () {\n      state.closed = true;\n      if (options.idb.onclose) options.idb.onclose();\n    };\n    /**\n     * if service-workers are used,\n     * we have no 'storage'-event if they post a message,\n     * therefore we also have to set an interval\n     */\n\n\n    _readLoop(state);\n\n    return state;\n  });\n}\n\nfunction _readLoop(state) {\n  if (state.closed) return;\n  readNewMessages(state).then(function () {\n    return sleep(state.options.idb.fallbackInterval);\n  }).then(function () {\n    return _readLoop(state);\n  });\n}\n\nfunction _filterMessage(msgObj, state) {\n  if (msgObj.uuid === state.uuid) return false; // send by own\n\n  if (state.eMIs.has(msgObj.id)) return false; // already emitted\n\n  if (msgObj.data.time < state.messagesCallbackTime) return false; // older then onMessageCallback\n\n  return true;\n}\n/**\n * reads all new messages from the database and emits them\n */\n\n\nfunction readNewMessages(state) {\n  // channel already closed\n  if (state.closed) return Promise.resolve(); // if no one is listening, we do not need to scan for new messages\n\n  if (!state.messagesCallback) return Promise.resolve();\n  return getMessagesHigherThan(state.db, state.lastCursorId).then(function (newerMessages) {\n    var useMessages = newerMessages\n    /**\n     * there is a bug in iOS where the msgObj can be undefined some times\n     * so we filter them out\n     * @link https://github.com/pubkey/broadcast-channel/issues/19\n     */\n    .filter(function (msgObj) {\n      return !!msgObj;\n    }).map(function (msgObj) {\n      if (msgObj.id > state.lastCursorId) {\n        state.lastCursorId = msgObj.id;\n      }\n\n      return msgObj;\n    }).filter(function (msgObj) {\n      return _filterMessage(msgObj, state);\n    }).sort(function (msgObjA, msgObjB) {\n      return msgObjA.time - msgObjB.time;\n    }); // sort by time\n\n    useMessages.forEach(function (msgObj) {\n      if (state.messagesCallback) {\n        state.eMIs.add(msgObj.id);\n        state.messagesCallback(msgObj.data);\n      }\n    });\n    return Promise.resolve();\n  });\n}\n\nexport function close(channelState) {\n  channelState.closed = true;\n  channelState.db.close();\n}\nexport function postMessage(channelState, messageJson) {\n  channelState.writeBlockPromise = channelState.writeBlockPromise.then(function () {\n    return writeMessage(channelState.db, channelState.uuid, messageJson);\n  }).then(function () {\n    if (randomInt(0, 10) === 0) {\n      /* await (do not await) */\n      cleanOldMessages(channelState.db, channelState.options.idb.ttl);\n    }\n  });\n  return channelState.writeBlockPromise;\n}\nexport function onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n  readNewMessages(channelState);\n}\nexport function canBeUsed() {\n  if (isNode) return false;\n  var idb = getIdb();\n  if (!idb) return false;\n  return true;\n}\nexport function averageResponseTime(options) {\n  return options.idb.fallbackInterval * 2;\n}\nexport default {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};"],"names":["getIdb","createDatabase","writeMessage","getAllMessages","getMessagesHigherThan","removeMessageById","getOldMessages","cleanOldMessages","create","close","postMessage","onMessage","canBeUsed","averageResponseTime","microSeconds","micro","DB_PREFIX","OBJECT_STORE_ID","type","indexedDB","window","mozIndexedDB","webkitIndexedDB","msIndexedDB","channelName","IndexedDB","dbName","openRequest","open","onupgradeneeded","ev","db","target","result","createObjectStore","keyPath","autoIncrement","dbPromise","Promise","res","rej","onerror","onsuccess","readerUuid","messageJson","time","Date","getTime","writeObject","uuid","data","transaction","oncomplete","objectStore","add","ret","openCursor","cursor","push","value","lastCursorId","keyRangeValue","IDBKeyRange","bound","Infinity","e","id","request","ttl","olderThen","msgObk","then","tooOld","all","map","msgObj","options","fillOptionsWithDefaults","state","closed","randomToken","eMIs","ObliviousSet","idb","writeBlockPromise","resolve","messagesCallback","readQueuePromises","onclose","_readLoop","readNewMessages","sleep","fallbackInterval","_filterMessage","has","messagesCallbackTime","newerMessages","useMessages","filter","sort","msgObjA","msgObjB","forEach","channelState","randomInt","fn","isNode"],"mappings":"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"}