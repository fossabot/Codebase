{"version":3,"sources":["../../../../../../../../../libs/movie/data-access/node_modules/broadcast-channel/dist/lib/methods/indexed-db.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getIdb = getIdb;\nexports.createDatabase = createDatabase;\nexports.writeMessage = writeMessage;\nexports.getAllMessages = getAllMessages;\nexports.getMessagesHigherThan = getMessagesHigherThan;\nexports.removeMessageById = removeMessageById;\nexports.getOldMessages = getOldMessages;\nexports.cleanOldMessages = cleanOldMessages;\nexports.create = create;\nexports.close = close;\nexports.postMessage = postMessage;\nexports.onMessage = onMessage;\nexports.canBeUsed = canBeUsed;\nexports.averageResponseTime = averageResponseTime;\nexports[\"default\"] = exports.type = exports.microSeconds = void 0;\n\nvar _util = require(\"../util.js\");\n\nvar _obliviousSet = require(\"oblivious-set\");\n\nvar _options = require(\"../options\");\n\n/**\n * this method uses indexeddb to store the messages\n * There is currently no observerAPI for idb\n * @link https://github.com/w3c/IndexedDB/issues/51\n */\nvar microSeconds = _util.microSeconds;\nexports.microSeconds = microSeconds;\nvar DB_PREFIX = 'pubkey.broadcast-channel-0-';\nvar OBJECT_STORE_ID = 'messages';\nvar type = 'idb';\nexports.type = type;\n\nfunction getIdb() {\n  if (typeof indexedDB !== 'undefined') return indexedDB;\n\n  if (typeof window !== 'undefined') {\n    if (typeof window.mozIndexedDB !== 'undefined') return window.mozIndexedDB;\n    if (typeof window.webkitIndexedDB !== 'undefined') return window.webkitIndexedDB;\n    if (typeof window.msIndexedDB !== 'undefined') return window.msIndexedDB;\n  }\n\n  return false;\n}\n\nfunction createDatabase(channelName) {\n  var IndexedDB = getIdb(); // create table\n\n  var dbName = DB_PREFIX + channelName;\n  var openRequest = IndexedDB.open(dbName, 1);\n\n  openRequest.onupgradeneeded = function (ev) {\n    var db = ev.target.result;\n    db.createObjectStore(OBJECT_STORE_ID, {\n      keyPath: 'id',\n      autoIncrement: true\n    });\n  };\n\n  var dbPromise = new Promise(function (res, rej) {\n    openRequest.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    openRequest.onsuccess = function () {\n      res(openRequest.result);\n    };\n  });\n  return dbPromise;\n}\n/**\n * writes the new message to the database\n * so other readers can find it\n */\n\n\nfunction writeMessage(db, readerUuid, messageJson) {\n  var time = new Date().getTime();\n  var writeObject = {\n    uuid: readerUuid,\n    time: time,\n    data: messageJson\n  };\n  var transaction = db.transaction([OBJECT_STORE_ID], 'readwrite');\n  return new Promise(function (res, rej) {\n    transaction.oncomplete = function () {\n      return res();\n    };\n\n    transaction.onerror = function (ev) {\n      return rej(ev);\n    };\n\n    var objectStore = transaction.objectStore(OBJECT_STORE_ID);\n    objectStore.add(writeObject);\n  });\n}\n\nfunction getAllMessages(db) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        ret.push(cursor.value); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n        cursor[\"continue\"]();\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\n\nfunction getMessagesHigherThan(db, lastCursorId) {\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n\n  function openCursor() {\n    // Occasionally Safari will fail on IDBKeyRange.bound, this\n    // catches that error, having it open the cursor to the first\n    // item. When it gets data it will advance to the desired key.\n    try {\n      var keyRangeValue = IDBKeyRange.bound(lastCursorId + 1, Infinity);\n      return objectStore.openCursor(keyRangeValue);\n    } catch (e) {\n      return objectStore.openCursor();\n    }\n  }\n\n  return new Promise(function (res) {\n    openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        if (cursor.value.id < lastCursorId + 1) {\n          cursor[\"continue\"](lastCursorId + 1);\n        } else {\n          ret.push(cursor.value);\n          cursor[\"continue\"]();\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\n\nfunction removeMessageById(db, id) {\n  var request = db.transaction([OBJECT_STORE_ID], 'readwrite').objectStore(OBJECT_STORE_ID)[\"delete\"](id);\n  return new Promise(function (res) {\n    request.onsuccess = function () {\n      return res();\n    };\n  });\n}\n\nfunction getOldMessages(db, ttl) {\n  var olderThen = new Date().getTime() - ttl;\n  var objectStore = db.transaction(OBJECT_STORE_ID).objectStore(OBJECT_STORE_ID);\n  var ret = [];\n  return new Promise(function (res) {\n    objectStore.openCursor().onsuccess = function (ev) {\n      var cursor = ev.target.result;\n\n      if (cursor) {\n        var msgObk = cursor.value;\n\n        if (msgObk.time < olderThen) {\n          ret.push(msgObk); //alert(\"Name for SSN \" + cursor.key + \" is \" + cursor.value.name);\n\n          cursor[\"continue\"]();\n        } else {\n          // no more old messages,\n          res(ret);\n          return;\n        }\n      } else {\n        res(ret);\n      }\n    };\n  });\n}\n\nfunction cleanOldMessages(db, ttl) {\n  return getOldMessages(db, ttl).then(function (tooOld) {\n    return Promise.all(tooOld.map(function (msgObj) {\n      return removeMessageById(db, msgObj.id);\n    }));\n  });\n}\n\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n  return createDatabase(channelName).then(function (db) {\n    var state = {\n      closed: false,\n      lastCursorId: 0,\n      channelName: channelName,\n      options: options,\n      uuid: (0, _util.randomToken)(),\n\n      /**\n       * emittedMessagesIds\n       * contains all messages that have been emitted before\n       * @type {ObliviousSet}\n       */\n      eMIs: new _obliviousSet.ObliviousSet(options.idb.ttl * 2),\n      // ensures we do not read messages in parrallel\n      writeBlockPromise: Promise.resolve(),\n      messagesCallback: null,\n      readQueuePromises: [],\n      db: db\n    };\n    /**\n     * Handle abrupt closes that do not originate from db.close().\n     * This could happen, for example, if the underlying storage is\n     * removed or if the user clears the database in the browser's\n     * history preferences.\n     */\n\n    db.onclose = function () {\n      state.closed = true;\n      if (options.idb.onclose) options.idb.onclose();\n    };\n    /**\n     * if service-workers are used,\n     * we have no 'storage'-event if they post a message,\n     * therefore we also have to set an interval\n     */\n\n\n    _readLoop(state);\n\n    return state;\n  });\n}\n\nfunction _readLoop(state) {\n  if (state.closed) return;\n  readNewMessages(state).then(function () {\n    return (0, _util.sleep)(state.options.idb.fallbackInterval);\n  }).then(function () {\n    return _readLoop(state);\n  });\n}\n\nfunction _filterMessage(msgObj, state) {\n  if (msgObj.uuid === state.uuid) return false; // send by own\n\n  if (state.eMIs.has(msgObj.id)) return false; // already emitted\n\n  if (msgObj.data.time < state.messagesCallbackTime) return false; // older then onMessageCallback\n\n  return true;\n}\n/**\n * reads all new messages from the database and emits them\n */\n\n\nfunction readNewMessages(state) {\n  // channel already closed\n  if (state.closed) return Promise.resolve(); // if no one is listening, we do not need to scan for new messages\n\n  if (!state.messagesCallback) return Promise.resolve();\n  return getMessagesHigherThan(state.db, state.lastCursorId).then(function (newerMessages) {\n    var useMessages = newerMessages\n    /**\n     * there is a bug in iOS where the msgObj can be undefined some times\n     * so we filter them out\n     * @link https://github.com/pubkey/broadcast-channel/issues/19\n     */\n    .filter(function (msgObj) {\n      return !!msgObj;\n    }).map(function (msgObj) {\n      if (msgObj.id > state.lastCursorId) {\n        state.lastCursorId = msgObj.id;\n      }\n\n      return msgObj;\n    }).filter(function (msgObj) {\n      return _filterMessage(msgObj, state);\n    }).sort(function (msgObjA, msgObjB) {\n      return msgObjA.time - msgObjB.time;\n    }); // sort by time\n\n    useMessages.forEach(function (msgObj) {\n      if (state.messagesCallback) {\n        state.eMIs.add(msgObj.id);\n        state.messagesCallback(msgObj.data);\n      }\n    });\n    return Promise.resolve();\n  });\n}\n\nfunction close(channelState) {\n  channelState.closed = true;\n  channelState.db.close();\n}\n\nfunction postMessage(channelState, messageJson) {\n  channelState.writeBlockPromise = channelState.writeBlockPromise.then(function () {\n    return writeMessage(channelState.db, channelState.uuid, messageJson);\n  }).then(function () {\n    if ((0, _util.randomInt)(0, 10) === 0) {\n      /* await (do not await) */\n      cleanOldMessages(channelState.db, channelState.options.idb.ttl);\n    }\n  });\n  return channelState.writeBlockPromise;\n}\n\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n  readNewMessages(channelState);\n}\n\nfunction canBeUsed() {\n  if (_util.isNode) return false;\n  var idb = getIdb();\n  if (!idb) return false;\n  return true;\n}\n\nfunction averageResponseTime(options) {\n  return options.idb.fallbackInterval * 2;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;"],"names":["Object","defineProperty","exports","value","getIdb","createDatabase","writeMessage","getAllMessages","getMessagesHigherThan","removeMessageById","getOldMessages","cleanOldMessages","create","close","postMessage","onMessage","canBeUsed","averageResponseTime","type","microSeconds","_util","require","_obliviousSet","_options","DB_PREFIX","OBJECT_STORE_ID","indexedDB","window","mozIndexedDB","webkitIndexedDB","msIndexedDB","channelName","IndexedDB","dbName","openRequest","open","onupgradeneeded","ev","db","target","result","createObjectStore","keyPath","autoIncrement","dbPromise","Promise","res","rej","onerror","onsuccess","readerUuid","messageJson","time","Date","getTime","writeObject","uuid","data","transaction","oncomplete","objectStore","add","ret","openCursor","cursor","push","lastCursorId","keyRangeValue","IDBKeyRange","bound","Infinity","e","id","request","ttl","olderThen","msgObk","then","tooOld","all","map","msgObj","options","fillOptionsWithDefaults","state","closed","randomToken","eMIs","ObliviousSet","idb","writeBlockPromise","resolve","messagesCallback","readQueuePromises","onclose","_readLoop","readNewMessages","sleep","fallbackInterval","_filterMessage","has","messagesCallbackTime","newerMessages","useMessages","filter","sort","msgObjA","msgObjB","forEach","channelState","randomInt","fn","isNode","_default"],"mappings":"AAAA,CAAY;AAEZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,CAAY,aAAE,CAAC;IAC5CC,KAAK,EAAE,IAAI;AACb,CAAC;AACDD,OAAO,CAACE,MAAM,GAAGA,MAAM;AACvBF,OAAO,CAACG,cAAc,GAAGA,cAAc;AACvCH,OAAO,CAACI,YAAY,GAAGA,YAAY;AACnCJ,OAAO,CAACK,cAAc,GAAGA,cAAc;AACvCL,OAAO,CAACM,qBAAqB,GAAGA,qBAAqB;AACrDN,OAAO,CAACO,iBAAiB,GAAGA,iBAAiB;AAC7CP,OAAO,CAACQ,cAAc,GAAGA,cAAc;AACvCR,OAAO,CAACS,gBAAgB,GAAGA,gBAAgB;AAC3CT,OAAO,CAACU,MAAM,GAAGA,MAAM;AACvBV,OAAO,CAACW,KAAK,GAAGA,KAAK;AACrBX,OAAO,CAACY,WAAW,GAAGA,WAAW;AACjCZ,OAAO,CAACa,SAAS,GAAGA,SAAS;AAC7Bb,OAAO,CAACc,SAAS,GAAGA,SAAS;AAC7Bd,OAAO,CAACe,mBAAmB,GAAGA,mBAAmB;AACjDf,OAAO,CAAC,CAAS,YAAIA,OAAO,CAACgB,IAAI,GAAGhB,OAAO,CAACiB,YAAY,GAAG,IAAI,CAAC,CAAC;AAEjE,GAAG,CAACC,KAAK,GAAGC,OAAO,CAAC,CAAY;AAEhC,GAAG,CAACC,aAAa,GAAGD,OAAO,CAAC,CAAe;AAE3C,GAAG,CAACE,QAAQ,GAAGF,OAAO,CAAC,CAAY;AAEnC,EAIG,AAJH;;;;CAIG,AAJH,EAIG,CACH,GAAG,CAACF,YAAY,GAAGC,KAAK,CAACD,YAAY;AACrCjB,OAAO,CAACiB,YAAY,GAAGA,YAAY;AACnC,GAAG,CAACK,SAAS,GAAG,CAA6B;AAC7C,GAAG,CAACC,eAAe,GAAG,CAAU;AAChC,GAAG,CAACP,IAAI,GAAG,CAAK;AAChBhB,OAAO,CAACgB,IAAI,GAAGA,IAAI;SAEVd,MAAM,GAAG,CAAC;IACjB,EAAE,EAAE,MAAM,CAACsB,SAAS,KAAK,CAAW,YAAE,MAAM,CAACA,SAAS;IAEtD,EAAE,EAAE,MAAM,CAACC,MAAM,KAAK,CAAW,YAAE,CAAC;QAClC,EAAE,EAAE,MAAM,CAACA,MAAM,CAACC,YAAY,KAAK,CAAW,YAAE,MAAM,CAACD,MAAM,CAACC,YAAY;QAC1E,EAAE,EAAE,MAAM,CAACD,MAAM,CAACE,eAAe,KAAK,CAAW,YAAE,MAAM,CAACF,MAAM,CAACE,eAAe;QAChF,EAAE,EAAE,MAAM,CAACF,MAAM,CAACG,WAAW,KAAK,CAAW,YAAE,MAAM,CAACH,MAAM,CAACG,WAAW;IAC1E,CAAC;IAED,MAAM,CAAC,KAAK;AACd,CAAC;SAEQzB,cAAc,CAAC0B,WAAW,EAAE,CAAC;IACpC,GAAG,CAACC,SAAS,GAAG5B,MAAM,GAAI,CAAe,AAAf,EAAe,AAAf,aAAe;IAEzC,GAAG,CAAC6B,MAAM,GAAGT,SAAS,GAAGO,WAAW;IACpC,GAAG,CAACG,WAAW,GAAGF,SAAS,CAACG,IAAI,CAACF,MAAM,EAAE,CAAC;IAE1CC,WAAW,CAACE,eAAe,GAAG,QAAQ,CAAEC,EAAE,EAAE,CAAC;QAC3C,GAAG,CAACC,EAAE,GAAGD,EAAE,CAACE,MAAM,CAACC,MAAM;QACzBF,EAAE,CAACG,iBAAiB,CAAChB,eAAe,EAAE,CAAC;YACrCiB,OAAO,EAAE,CAAI;YACbC,aAAa,EAAE,IAAI;QACrB,CAAC;IACH,CAAC;IAED,GAAG,CAACC,SAAS,GAAG,GAAG,CAACC,OAAO,CAAC,QAAQ,CAAEC,GAAG,EAAEC,GAAG,EAAE,CAAC;QAC/Cb,WAAW,CAACc,OAAO,GAAG,QAAQ,CAAEX,EAAE,EAAE,CAAC;YACnC,MAAM,CAACU,GAAG,CAACV,EAAE;QACf,CAAC;QAEDH,WAAW,CAACe,SAAS,GAAG,QAAQ,GAAI,CAAC;YACnCH,GAAG,CAACZ,WAAW,CAACM,MAAM;QACxB,CAAC;IACH,CAAC;IACD,MAAM,CAACI,SAAS;AAClB,CAAC;AACD,EAGG,AAHH;;;CAGG,AAHH,EAGG,UAGMtC,YAAY,CAACgC,EAAE,EAAEY,UAAU,EAAEC,WAAW,EAAE,CAAC;IAClD,GAAG,CAACC,IAAI,GAAG,GAAG,CAACC,IAAI,GAAGC,OAAO;IAC7B,GAAG,CAACC,WAAW,GAAG,CAAC;QACjBC,IAAI,EAAEN,UAAU;QAChBE,IAAI,EAAEA,IAAI;QACVK,IAAI,EAAEN,WAAW;IACnB,CAAC;IACD,GAAG,CAACO,WAAW,GAAGpB,EAAE,CAACoB,WAAW,CAAC,CAACjC;QAAAA,eAAe;IAAA,CAAC,EAAE,CAAW;IAC/D,MAAM,CAAC,GAAG,CAACoB,OAAO,CAAC,QAAQ,CAAEC,GAAG,EAAEC,GAAG,EAAE,CAAC;QACtCW,WAAW,CAACC,UAAU,GAAG,QAAQ,GAAI,CAAC;YACpC,MAAM,CAACb,GAAG;QACZ,CAAC;QAEDY,WAAW,CAACV,OAAO,GAAG,QAAQ,CAAEX,EAAE,EAAE,CAAC;YACnC,MAAM,CAACU,GAAG,CAACV,EAAE;QACf,CAAC;QAED,GAAG,CAACuB,WAAW,GAAGF,WAAW,CAACE,WAAW,CAACnC,eAAe;QACzDmC,WAAW,CAACC,GAAG,CAACN,WAAW;IAC7B,CAAC;AACH,CAAC;SAEQhD,cAAc,CAAC+B,EAAE,EAAE,CAAC;IAC3B,GAAG,CAACsB,WAAW,GAAGtB,EAAE,CAACoB,WAAW,CAACjC,eAAe,EAAEmC,WAAW,CAACnC,eAAe;IAC7E,GAAG,CAACqC,GAAG,GAAG,CAAC,CAAC;IACZ,MAAM,CAAC,GAAG,CAACjB,OAAO,CAAC,QAAQ,CAAEC,GAAG,EAAE,CAAC;QACjCc,WAAW,CAACG,UAAU,GAAGd,SAAS,GAAG,QAAQ,CAAEZ,EAAE,EAAE,CAAC;YAClD,GAAG,CAAC2B,MAAM,GAAG3B,EAAE,CAACE,MAAM,CAACC,MAAM;YAE7B,EAAE,EAAEwB,MAAM,EAAE,CAAC;gBACXF,GAAG,CAACG,IAAI,CAACD,MAAM,CAAC7D,KAAK,EAAG,CAAmE,AAAnE,EAAmE,AAAnE,iEAAmE;gBAE3F6D,MAAM,CAAC,CAAU;YACnB,CAAC,MAAM,CAAC;gBACNlB,GAAG,CAACgB,GAAG;YACT,CAAC;QACH,CAAC;IACH,CAAC;AACH,CAAC;SAEQtD,qBAAqB,CAAC8B,EAAE,EAAE4B,YAAY,EAAE,CAAC;IAChD,GAAG,CAACN,WAAW,GAAGtB,EAAE,CAACoB,WAAW,CAACjC,eAAe,EAAEmC,WAAW,CAACnC,eAAe;IAC7E,GAAG,CAACqC,GAAG,GAAG,CAAC,CAAC;aAEHC,UAAU,GAAG,CAAC;QACrB,EAA2D,AAA3D,yDAA2D;QAC3D,EAA6D,AAA7D,2DAA6D;QAC7D,EAA8D,AAA9D,4DAA8D;QAC9D,GAAG,CAAC,CAAC;YACH,GAAG,CAACI,aAAa,GAAGC,WAAW,CAACC,KAAK,CAACH,YAAY,GAAG,CAAC,EAAEI,QAAQ;YAChE,MAAM,CAACV,WAAW,CAACG,UAAU,CAACI,aAAa;QAC7C,CAAC,CAAC,KAAK,EAAEI,CAAC,EAAE,CAAC;YACX,MAAM,CAACX,WAAW,CAACG,UAAU;QAC/B,CAAC;IACH,CAAC;IAED,MAAM,CAAC,GAAG,CAAClB,OAAO,CAAC,QAAQ,CAAEC,GAAG,EAAE,CAAC;QACjCiB,UAAU,GAAGd,SAAS,GAAG,QAAQ,CAAEZ,EAAE,EAAE,CAAC;YACtC,GAAG,CAAC2B,MAAM,GAAG3B,EAAE,CAACE,MAAM,CAACC,MAAM;YAE7B,EAAE,EAAEwB,MAAM,EAAE,CAAC;gBACX,EAAE,EAAEA,MAAM,CAAC7D,KAAK,CAACqE,EAAE,GAAGN,YAAY,GAAG,CAAC,EAAE,CAAC;oBACvCF,MAAM,CAAC,CAAU,WAAEE,YAAY,GAAG,CAAC;gBACrC,CAAC,MAAM,CAAC;oBACNJ,GAAG,CAACG,IAAI,CAACD,MAAM,CAAC7D,KAAK;oBACrB6D,MAAM,CAAC,CAAU;gBACnB,CAAC;YACH,CAAC,MAAM,CAAC;gBACNlB,GAAG,CAACgB,GAAG;YACT,CAAC;QACH,CAAC;IACH,CAAC;AACH,CAAC;SAEQrD,iBAAiB,CAAC6B,EAAE,EAAEkC,EAAE,EAAE,CAAC;IAClC,GAAG,CAACC,OAAO,GAAGnC,EAAE,CAACoB,WAAW,CAAC,CAACjC;QAAAA,eAAe;IAAA,CAAC,EAAE,CAAW,YAAEmC,WAAW,CAACnC,eAAe,EAAE,CAAQ,SAAE+C,EAAE;IACtG,MAAM,CAAC,GAAG,CAAC3B,OAAO,CAAC,QAAQ,CAAEC,GAAG,EAAE,CAAC;QACjC2B,OAAO,CAACxB,SAAS,GAAG,QAAQ,GAAI,CAAC;YAC/B,MAAM,CAACH,GAAG;QACZ,CAAC;IACH,CAAC;AACH,CAAC;SAEQpC,cAAc,CAAC4B,EAAE,EAAEoC,GAAG,EAAE,CAAC;IAChC,GAAG,CAACC,SAAS,GAAG,GAAG,CAACtB,IAAI,GAAGC,OAAO,KAAKoB,GAAG;IAC1C,GAAG,CAACd,WAAW,GAAGtB,EAAE,CAACoB,WAAW,CAACjC,eAAe,EAAEmC,WAAW,CAACnC,eAAe;IAC7E,GAAG,CAACqC,GAAG,GAAG,CAAC,CAAC;IACZ,MAAM,CAAC,GAAG,CAACjB,OAAO,CAAC,QAAQ,CAAEC,GAAG,EAAE,CAAC;QACjCc,WAAW,CAACG,UAAU,GAAGd,SAAS,GAAG,QAAQ,CAAEZ,EAAE,EAAE,CAAC;YAClD,GAAG,CAAC2B,MAAM,GAAG3B,EAAE,CAACE,MAAM,CAACC,MAAM;YAE7B,EAAE,EAAEwB,MAAM,EAAE,CAAC;gBACX,GAAG,CAACY,MAAM,GAAGZ,MAAM,CAAC7D,KAAK;gBAEzB,EAAE,EAAEyE,MAAM,CAACxB,IAAI,GAAGuB,SAAS,EAAE,CAAC;oBAC5Bb,GAAG,CAACG,IAAI,CAACW,MAAM,EAAG,CAAmE,AAAnE,EAAmE,AAAnE,iEAAmE;oBAErFZ,MAAM,CAAC,CAAU;gBACnB,CAAC,MAAM,CAAC;oBACN,EAAwB,AAAxB,sBAAwB;oBACxBlB,GAAG,CAACgB,GAAG;oBACP,MAAM;gBACR,CAAC;YACH,CAAC,MAAM,CAAC;gBACNhB,GAAG,CAACgB,GAAG;YACT,CAAC;QACH,CAAC;IACH,CAAC;AACH,CAAC;SAEQnD,gBAAgB,CAAC2B,EAAE,EAAEoC,GAAG,EAAE,CAAC;IAClC,MAAM,CAAChE,cAAc,CAAC4B,EAAE,EAAEoC,GAAG,EAAEG,IAAI,CAAC,QAAQ,CAAEC,MAAM,EAAE,CAAC;QACrD,MAAM,CAACjC,OAAO,CAACkC,GAAG,CAACD,MAAM,CAACE,GAAG,CAAC,QAAQ,CAAEC,MAAM,EAAE,CAAC;YAC/C,MAAM,CAACxE,iBAAiB,CAAC6B,EAAE,EAAE2C,MAAM,CAACT,EAAE;QACxC,CAAC;IACH,CAAC;AACH,CAAC;SAEQ5D,MAAM,CAACmB,WAAW,EAAEmD,OAAO,EAAE,CAAC;IACrCA,OAAO,IAAI,CAAC,EAAE3D,QAAQ,CAAC4D,uBAAuB,EAAED,OAAO;IACvD,MAAM,CAAC7E,cAAc,CAAC0B,WAAW,EAAE8C,IAAI,CAAC,QAAQ,CAAEvC,EAAE,EAAE,CAAC;QACrD,GAAG,CAAC8C,KAAK,GAAG,CAAC;YACXC,MAAM,EAAE,KAAK;YACbnB,YAAY,EAAE,CAAC;YACfnC,WAAW,EAAEA,WAAW;YACxBmD,OAAO,EAAEA,OAAO;YAChB1B,IAAI,GAAG,CAAC,EAAEpC,KAAK,CAACkE,WAAW;YAE3B,EAIG,AAJH;;;;OAIG,AAJH,EAIG,CACHC,IAAI,EAAE,GAAG,CAACjE,aAAa,CAACkE,YAAY,CAACN,OAAO,CAACO,GAAG,CAACf,GAAG,GAAG,CAAC;YACxD,EAA+C,AAA/C,6CAA+C;YAC/CgB,iBAAiB,EAAE7C,OAAO,CAAC8C,OAAO;YAClCC,gBAAgB,EAAE,IAAI;YACtBC,iBAAiB,EAAE,CAAC,CAAC;YACrBvD,EAAE,EAAEA,EAAE;QACR,CAAC;QACD,EAKG,AALH;;;;;KAKG,AALH,EAKG,CAEHA,EAAE,CAACwD,OAAO,GAAG,QAAQ,GAAI,CAAC;YACxBV,KAAK,CAACC,MAAM,GAAG,IAAI;YACnB,EAAE,EAAEH,OAAO,CAACO,GAAG,CAACK,OAAO,EAAEZ,OAAO,CAACO,GAAG,CAACK,OAAO;QAC9C,CAAC;QACD,EAIG,AAJH;;;;KAIG,AAJH,EAIG,CAGHC,SAAS,CAACX,KAAK;QAEf,MAAM,CAACA,KAAK;IACd,CAAC;AACH,CAAC;SAEQW,SAAS,CAACX,KAAK,EAAE,CAAC;IACzB,EAAE,EAAEA,KAAK,CAACC,MAAM,EAAE,MAAM;IACxBW,eAAe,CAACZ,KAAK,EAAEP,IAAI,CAAC,QAAQ,GAAI,CAAC;QACvC,MAAM,EAAE,CAAC,EAAEzD,KAAK,CAAC6E,KAAK,EAAEb,KAAK,CAACF,OAAO,CAACO,GAAG,CAACS,gBAAgB;IAC5D,CAAC,EAAErB,IAAI,CAAC,QAAQ,GAAI,CAAC;QACnB,MAAM,CAACkB,SAAS,CAACX,KAAK;IACxB,CAAC;AACH,CAAC;SAEQe,cAAc,CAAClB,MAAM,EAAEG,KAAK,EAAE,CAAC;IACtC,EAAE,EAAEH,MAAM,CAACzB,IAAI,KAAK4B,KAAK,CAAC5B,IAAI,EAAE,MAAM,CAAC,KAAK,CAAE,CAAc,AAAd,EAAc,AAAd,YAAc;IAE5D,EAAE,EAAE4B,KAAK,CAACG,IAAI,CAACa,GAAG,CAACnB,MAAM,CAACT,EAAE,GAAG,MAAM,CAAC,KAAK,CAAE,CAAkB,AAAlB,EAAkB,AAAlB,gBAAkB;IAE/D,EAAE,EAAES,MAAM,CAACxB,IAAI,CAACL,IAAI,GAAGgC,KAAK,CAACiB,oBAAoB,EAAE,MAAM,CAAC,KAAK,CAAE,CAA+B,AAA/B,EAA+B,AAA/B,6BAA+B;IAEhG,MAAM,CAAC,IAAI;AACb,CAAC;AACD,EAEG,AAFH;;CAEG,AAFH,EAEG,UAGML,eAAe,CAACZ,KAAK,EAAE,CAAC;IAC/B,EAAyB,AAAzB,uBAAyB;IACzB,EAAE,EAAEA,KAAK,CAACC,MAAM,EAAE,MAAM,CAACxC,OAAO,CAAC8C,OAAO,GAAI,CAAkE,AAAlE,EAAkE,AAAlE,gEAAkE;IAE9G,EAAE,GAAGP,KAAK,CAACQ,gBAAgB,EAAE,MAAM,CAAC/C,OAAO,CAAC8C,OAAO;IACnD,MAAM,CAACnF,qBAAqB,CAAC4E,KAAK,CAAC9C,EAAE,EAAE8C,KAAK,CAAClB,YAAY,EAAEW,IAAI,CAAC,QAAQ,CAAEyB,aAAa,EAAE,CAAC;QACxF,GAAG,CAACC,WAAW,GAAGD,aAAa,AAC/B,EAIG,AAJH;;;;KAIG,AAJH,EAIG,EACFE,MAAM,CAAC,QAAQ,CAAEvB,MAAM,EAAE,CAAC;YACzB,MAAM,GAAGA,MAAM;QACjB,CAAC,EAAED,GAAG,CAAC,QAAQ,CAAEC,MAAM,EAAE,CAAC;YACxB,EAAE,EAAEA,MAAM,CAACT,EAAE,GAAGY,KAAK,CAAClB,YAAY,EAAE,CAAC;gBACnCkB,KAAK,CAAClB,YAAY,GAAGe,MAAM,CAACT,EAAE;YAChC,CAAC;YAED,MAAM,CAACS,MAAM;QACf,CAAC,EAAEuB,MAAM,CAAC,QAAQ,CAAEvB,MAAM,EAAE,CAAC;YAC3B,MAAM,CAACkB,cAAc,CAAClB,MAAM,EAAEG,KAAK;QACrC,CAAC,EAAEqB,IAAI,CAAC,QAAQ,CAAEC,OAAO,EAAEC,OAAO,EAAE,CAAC;YACnC,MAAM,CAACD,OAAO,CAACtD,IAAI,GAAGuD,OAAO,CAACvD,IAAI;QACpC,CAAC,EAAG,CAAe,AAAf,EAAe,AAAf,aAAe;QAEnBmD,WAAW,CAACK,OAAO,CAAC,QAAQ,CAAE3B,MAAM,EAAE,CAAC;YACrC,EAAE,EAAEG,KAAK,CAACQ,gBAAgB,EAAE,CAAC;gBAC3BR,KAAK,CAACG,IAAI,CAAC1B,GAAG,CAACoB,MAAM,CAACT,EAAE;gBACxBY,KAAK,CAACQ,gBAAgB,CAACX,MAAM,CAACxB,IAAI;YACpC,CAAC;QACH,CAAC;QACD,MAAM,CAACZ,OAAO,CAAC8C,OAAO;IACxB,CAAC;AACH,CAAC;SAEQ9E,KAAK,CAACgG,YAAY,EAAE,CAAC;IAC5BA,YAAY,CAACxB,MAAM,GAAG,IAAI;IAC1BwB,YAAY,CAACvE,EAAE,CAACzB,KAAK;AACvB,CAAC;SAEQC,WAAW,CAAC+F,YAAY,EAAE1D,WAAW,EAAE,CAAC;IAC/C0D,YAAY,CAACnB,iBAAiB,GAAGmB,YAAY,CAACnB,iBAAiB,CAACb,IAAI,CAAC,QAAQ,GAAI,CAAC;QAChF,MAAM,CAACvE,YAAY,CAACuG,YAAY,CAACvE,EAAE,EAAEuE,YAAY,CAACrD,IAAI,EAAEL,WAAW;IACrE,CAAC,EAAE0B,IAAI,CAAC,QAAQ,GAAI,CAAC;QACnB,EAAE,GAAG,CAAC,EAAEzD,KAAK,CAAC0F,SAAS,EAAE,CAAC,EAAE,EAAE,MAAM,CAAC,EAAE,CAAC;YACtC,EAA0B,AAA1B,sBAA0B,AAA1B,EAA0B,CAC1BnG,gBAAgB,CAACkG,YAAY,CAACvE,EAAE,EAAEuE,YAAY,CAAC3B,OAAO,CAACO,GAAG,CAACf,GAAG;QAChE,CAAC;IACH,CAAC;IACD,MAAM,CAACmC,YAAY,CAACnB,iBAAiB;AACvC,CAAC;SAEQ3E,SAAS,CAAC8F,YAAY,EAAEE,EAAE,EAAE3D,IAAI,EAAE,CAAC;IAC1CyD,YAAY,CAACR,oBAAoB,GAAGjD,IAAI;IACxCyD,YAAY,CAACjB,gBAAgB,GAAGmB,EAAE;IAClCf,eAAe,CAACa,YAAY;AAC9B,CAAC;SAEQ7F,SAAS,GAAG,CAAC;IACpB,EAAE,EAAEI,KAAK,CAAC4F,MAAM,EAAE,MAAM,CAAC,KAAK;IAC9B,GAAG,CAACvB,GAAG,GAAGrF,MAAM;IAChB,EAAE,GAAGqF,GAAG,EAAE,MAAM,CAAC,KAAK;IACtB,MAAM,CAAC,IAAI;AACb,CAAC;SAEQxE,mBAAmB,CAACiE,OAAO,EAAE,CAAC;IACrC,MAAM,CAACA,OAAO,CAACO,GAAG,CAACS,gBAAgB,GAAG,CAAC;AACzC,CAAC;AAED,GAAG,CAACe,QAAQ,GAAG,CAAC;IACdrG,MAAM,EAAEA,MAAM;IACdC,KAAK,EAAEA,KAAK;IACZE,SAAS,EAAEA,SAAS;IACpBD,WAAW,EAAEA,WAAW;IACxBE,SAAS,EAAEA,SAAS;IACpBE,IAAI,EAAEA,IAAI;IACVD,mBAAmB,EAAEA,mBAAmB;IACxCE,YAAY,EAAEA,YAAY;AAC5B,CAAC;AACDjB,OAAO,CAAC,CAAS,YAAI+G,QAAQ"}