{"version":3,"sources":["../../../../../../../libs/movie/data-access/src/lib/group/index.ts"],"sourcesContent":["import { ApiMovieModel, DBGroupModel } from \"../../types\";\nimport { getClient } from \"../../utils\";\nimport axios, { Axios } from \"axios\";\nconst sbClient = getClient();\n\nexport const addMovieToGroup = async (\n  movie: ApiMovieModel,\n  groupId: DBGroupModel[\"id\"]\n) => {\n  try {\n    const id = movie.id;\n    const { data: result } = await axios.post(`/api/groups/${groupId}/movies`, {\n      ...movie,\n      movie_id: id,\n    });\n    return [{}, null];\n  } catch (e) {\n    return [null, e];\n  }\n};\n\nexport const getGroupFromId = async (groupId: string) => {\n  const { data: group } = await axios.get(`/api/groups/${groupId}`);\n  return group;\n};\n\nexport const getGroupIcon = (group: DBGroupModel): unkown => {\n  if (group.group_icon) {\n    const [bucket, ...pathArr] = group.group_icon.split(\"/\");\n    const path = pathArr.join(\"/\");\n    const res = sbClient.storage.from(bucket).getPublicUrl(path);\n    return [res.data?.publicURL, res.error];\n  } else {\n    return [null, null];\n  }\n};\n\nexport const getGroupFromMember = async (userId: string) => {\n  const { data, error } = await sbClient\n    .from(\"group_members\")\n    .select()\n    .eq(\"user_id\", userId);\n  if (data) {\n    const result = data.map(async (value) => {\n      const [gruop, error] = await getGroupFromId(value.group_id);\n      return gruop;\n    });\n    const toReturn = await Promise.all(result);\n    return [toReturn, error];\n  } else {\n    return [null, null];\n  }\n};\n\nexport const isMemberInGroup = async (\n  userId: string,\n  groupId: DBGroupModel[\"id\"]\n) => {\n  const { data, error } = await sbClient\n    .from(\"group_members\")\n    .select()\n    .eq(\"user_id\", userId)\n    .eq(\"group_id\", groupId)\n    .maybeSingle();\n  error ? console.log(\"ERROR\", error) : null;\n  return data ? true : false;\n};\n\nexport const createGroup = async (groupName: DBGroupModel[\"name\"]) => {\n  try {\n    const { data: result } = await axios.post(\n      \"/api/groups\",\n      {},\n      { params: { name: groupName } }\n    );\n    return [result, null];\n  } catch (e) {\n    return [null, e];\n  }\n};\n\n// export const getGroup = async ()  => {\n//   try {\n//     const { data: result } = await axios.get(\n//       \"/api/groups\",\n//       {},\n//       { params: { name: groupName } }\n//     );\n//     return [result, null];\n//   } catch (e) {\n//     return [null, e];\n//   }\n// }\n"],"names":["sbClient","getClient","addMovieToGroup","movie","groupId","id","data","result","axios","post","movie_id","e","getGroupFromId","group","get","getGroupIcon","group_icon","res","bucket","pathArr","split","path","join","storage","from","getPublicUrl","publicURL","error","getGroupFromMember","userId","select","eq","map","value","gruop","group_id","toReturn","Promise","all","isMemberInGroup","maybeSingle","console","log","createGroup","groupName","params","name"],"mappings":"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"}