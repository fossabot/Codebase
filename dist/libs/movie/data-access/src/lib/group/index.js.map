{"version":3,"sources":["../../../../../../../libs/movie/data-access/src/lib/group/index.ts"],"sourcesContent":["import { ApiMovieModel, DBGroupModel } from \"../../types\";\nimport { getClient } from \"../../utils\";\nimport axios from \"axios\";\nconst sbClient = getClient();\n\nexport const addMovieToGroup = async (\n  movie: ApiMovieModel,\n  groupId: DBGroupModel[\"id\"]\n) => {\n  const { data, error } = await sbClient\n    .from(\"movies\")\n    .select()\n    .eq(\"movie_id\", movie[\"id\"])\n    .eq(\"group_id\", groupId);\n  if (!data?.length) {\n    const insert = {\n      backdrop_path: movie.backdrop_path,\n      title: movie.title,\n      overview: movie.overview,\n      group_id: groupId,\n      poster_path: movie.poster_path,\n      release_date: movie.release_date,\n      movie_id: movie.id,\n      adult: movie.adult,\n    };\n\n    const { data, error } = await sbClient.from(\"movies\").insert(insert);\n    if (error) console.log(error);\n    return [data, error];\n  } else return [null, null];\n};\n\nexport const getGroupFromId = async (groupId: string) => {\n  const { data: group } = await axios.get(`/api/groups/${groupId}`);\n  return group;\n};\n\nexport const getGroupIcon = (group: DBGroupModel): any => {\n  if (group.group_icon) {\n    const [bucket, ...pathArr] = group.group_icon.split(\"/\");\n    const path = pathArr.join(\"/\");\n    const res = sbClient.storage.from(bucket).getPublicUrl(path);\n    return [res.data?.publicURL, res.error];\n  } else {\n    return [null, null];\n  }\n};\n\nexport const getGroupFromMember = async (userId: string) => {\n  const { data, error } = await sbClient\n    .from(\"group_members\")\n    .select()\n    .eq(\"user_id\", userId);\n  if (data) {\n    const result = data.map(async (value) => {\n      const [gruop, error] = await getGroupFromId(value.group_id);\n      return gruop;\n    });\n    const toReturn = await Promise.all(result);\n    return [toReturn, error];\n  } else {\n    return [null, null];\n  }\n};\n\nexport const isMemberInGroup = async (\n  userId: string,\n  groupId: DBGroupModel[\"id\"]\n) => {\n  const { data, error } = await sbClient\n    .from(\"group_members\")\n    .select()\n    .eq(\"user_id\", userId)\n    .eq(\"group_id\", groupId)\n    .maybeSingle();\n  error ? console.log(\"ERROR\", error) : null;\n  return data ? true : false;\n};\n\nexport const createGroup = async (groupName: DBGroupModel[\"name\"]) => {\n  try {\n    const { data: result } = await axios.post(\n      \"/api/groups\",\n      {},\n      { params: { name: groupName } }\n    );\n    return [result, null];\n  } catch (e) {\n    return [null, e];\n  }\n};\n\n// export const getGroup = async ()  => {\n//   try {\n//     const { data: result } = await axios.get(\n//       \"/api/groups\",\n//       {},\n//       { params: { name: groupName } }\n//     );\n//     return [result, null];\n//   } catch (e) {\n//     return [null, e];\n//   }\n// }\n"],"names":["sbClient","getClient","addMovieToGroup","movie","groupId","data","error","from","select","eq","length","insert","backdrop_path","title","overview","group_id","poster_path","release_date","movie_id","id","adult","console","log","getGroupFromId","group","axios","get","getGroupIcon","group_icon","res","bucket","pathArr","split","path","join","storage","getPublicUrl","publicURL","getGroupFromMember","userId","result","map","value","gruop","toReturn","Promise","all","isMemberInGroup","maybeSingle","createGroup","groupName","post","params","name","e"],"mappings":"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"}