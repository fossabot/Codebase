{"version":3,"sources":["../../../../../../../../libs/movie/data-access/node_modules/react-query/lib/core/queriesObserver.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.QueriesObserver = void 0;\n\nvar _inheritsLoose2 = _interopRequireDefault(require(\"@babel/runtime/helpers/inheritsLoose\"));\n\nvar _utils = require(\"./utils\");\n\nvar _notifyManager = require(\"./notifyManager\");\n\nvar _queryObserver = require(\"./queryObserver\");\n\nvar _subscribable = require(\"./subscribable\");\n\nvar QueriesObserver = /*#__PURE__*/function (_Subscribable) {\n  (0, _inheritsLoose2.default)(QueriesObserver, _Subscribable);\n\n  function QueriesObserver(client, queries) {\n    var _this;\n\n    _this = _Subscribable.call(this) || this;\n    _this.client = client;\n    _this.queries = [];\n    _this.result = [];\n    _this.observers = [];\n    _this.observersMap = {};\n\n    if (queries) {\n      _this.setQueries(queries);\n    }\n\n    return _this;\n  }\n\n  var _proto = QueriesObserver.prototype;\n\n  _proto.onSubscribe = function onSubscribe() {\n    var _this2 = this;\n\n    if (this.listeners.length === 1) {\n      this.observers.forEach(function (observer) {\n        observer.subscribe(function (result) {\n          _this2.onUpdate(observer, result);\n        });\n      });\n    }\n  };\n\n  _proto.onUnsubscribe = function onUnsubscribe() {\n    if (!this.listeners.length) {\n      this.destroy();\n    }\n  };\n\n  _proto.destroy = function destroy() {\n    this.listeners = [];\n    this.observers.forEach(function (observer) {\n      observer.destroy();\n    });\n  };\n\n  _proto.setQueries = function setQueries(queries, notifyOptions) {\n    this.queries = queries;\n    this.updateObservers(notifyOptions);\n  };\n\n  _proto.getCurrentResult = function getCurrentResult() {\n    return this.result;\n  };\n\n  _proto.getOptimisticResult = function getOptimisticResult(queries) {\n    return this.findMatchingObservers(queries).map(function (match) {\n      return match.observer.getOptimisticResult(match.defaultedQueryOptions);\n    });\n  };\n\n  _proto.findMatchingObservers = function findMatchingObservers(queries) {\n    var _this3 = this;\n\n    var prevObservers = this.observers;\n    var defaultedQueryOptions = queries.map(function (options) {\n      return _this3.client.defaultQueryObserverOptions(options);\n    });\n    var matchingObservers = defaultedQueryOptions.flatMap(function (defaultedOptions) {\n      var match = prevObservers.find(function (observer) {\n        return observer.options.queryHash === defaultedOptions.queryHash;\n      });\n\n      if (match != null) {\n        return [{\n          defaultedQueryOptions: defaultedOptions,\n          observer: match\n        }];\n      }\n\n      return [];\n    });\n    var matchedQueryHashes = matchingObservers.map(function (match) {\n      return match.defaultedQueryOptions.queryHash;\n    });\n    var unmatchedQueries = defaultedQueryOptions.filter(function (defaultedOptions) {\n      return !matchedQueryHashes.includes(defaultedOptions.queryHash);\n    });\n    var unmatchedObservers = prevObservers.filter(function (prevObserver) {\n      return !matchingObservers.some(function (match) {\n        return match.observer === prevObserver;\n      });\n    });\n    var newOrReusedObservers = unmatchedQueries.map(function (options, index) {\n      if (options.keepPreviousData) {\n        // return previous data from one of the observers that no longer match\n        var previouslyUsedObserver = unmatchedObservers[index];\n\n        if (previouslyUsedObserver !== undefined) {\n          return {\n            defaultedQueryOptions: options,\n            observer: previouslyUsedObserver\n          };\n        }\n      }\n\n      return {\n        defaultedQueryOptions: options,\n        observer: _this3.getObserver(options)\n      };\n    });\n\n    var sortMatchesByOrderOfQueries = function sortMatchesByOrderOfQueries(a, b) {\n      return defaultedQueryOptions.indexOf(a.defaultedQueryOptions) - defaultedQueryOptions.indexOf(b.defaultedQueryOptions);\n    };\n\n    return matchingObservers.concat(newOrReusedObservers).sort(sortMatchesByOrderOfQueries);\n  };\n\n  _proto.getObserver = function getObserver(options) {\n    var defaultedOptions = this.client.defaultQueryObserverOptions(options);\n    var currentObserver = this.observersMap[defaultedOptions.queryHash];\n    return currentObserver != null ? currentObserver : new _queryObserver.QueryObserver(this.client, defaultedOptions);\n  };\n\n  _proto.updateObservers = function updateObservers(notifyOptions) {\n    var _this4 = this;\n\n    _notifyManager.notifyManager.batch(function () {\n      var prevObservers = _this4.observers;\n\n      var newObserverMatches = _this4.findMatchingObservers(_this4.queries); // set options for the new observers to notify of changes\n\n\n      newObserverMatches.forEach(function (match) {\n        return match.observer.setOptions(match.defaultedQueryOptions, notifyOptions);\n      });\n      var newObservers = newObserverMatches.map(function (match) {\n        return match.observer;\n      });\n      var newObserversMap = Object.fromEntries(newObservers.map(function (observer) {\n        return [observer.options.queryHash, observer];\n      }));\n      var newResult = newObservers.map(function (observer) {\n        return observer.getCurrentResult();\n      });\n      var hasIndexChange = newObservers.some(function (observer, index) {\n        return observer !== prevObservers[index];\n      });\n\n      if (prevObservers.length === newObservers.length && !hasIndexChange) {\n        return;\n      }\n\n      _this4.observers = newObservers;\n      _this4.observersMap = newObserversMap;\n      _this4.result = newResult;\n\n      if (!_this4.hasListeners()) {\n        return;\n      }\n\n      (0, _utils.difference)(prevObservers, newObservers).forEach(function (observer) {\n        observer.destroy();\n      });\n      (0, _utils.difference)(newObservers, prevObservers).forEach(function (observer) {\n        observer.subscribe(function (result) {\n          _this4.onUpdate(observer, result);\n        });\n      });\n\n      _this4.notify();\n    });\n  };\n\n  _proto.onUpdate = function onUpdate(observer, result) {\n    var index = this.observers.indexOf(observer);\n\n    if (index !== -1) {\n      this.result = (0, _utils.replaceAt)(this.result, index, result);\n      this.notify();\n    }\n  };\n\n  _proto.notify = function notify() {\n    var _this5 = this;\n\n    _notifyManager.notifyManager.batch(function () {\n      _this5.listeners.forEach(function (listener) {\n        listener(_this5.result);\n      });\n    });\n  };\n\n  return QueriesObserver;\n}(_subscribable.Subscribable);\n\nexports.QueriesObserver = QueriesObserver;"],"names":["_interopRequireDefault","require","exports","__esModule","QueriesObserver","_inheritsLoose2","_utils","_notifyManager","_queryObserver","_subscribable","_Subscribable","default","client","queries","_this","call","result","observers","observersMap","setQueries","_proto","prototype","onSubscribe","_this2","listeners","length","forEach","observer","subscribe","onUpdate","onUnsubscribe","destroy","notifyOptions","updateObservers","getCurrentResult","getOptimisticResult","findMatchingObservers","map","match","defaultedQueryOptions","_this3","prevObservers","options","defaultQueryObserverOptions","matchingObservers","flatMap","defaultedOptions","find","queryHash","matchedQueryHashes","unmatchedQueries","filter","includes","unmatchedObservers","prevObserver","some","newOrReusedObservers","index","keepPreviousData","previouslyUsedObserver","undefined","getObserver","sortMatchesByOrderOfQueries","a","b","indexOf","concat","sort","currentObserver","QueryObserver","_this4","notifyManager","batch","newObserverMatches","setOptions","newObservers","newObserversMap","Object","fromEntries","newResult","hasIndexChange","hasListeners","difference","notify","replaceAt","_this5","listener","Subscribable"],"mappings":"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"}