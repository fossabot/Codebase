{"version":3,"sources":["../../../../../../../../libs/movie/data-access/node_modules/react-query/lib/createWebStoragePersistor-experimental/index.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nexports.__esModule = true;\nexports.createWebStoragePersistor = createWebStoragePersistor;\n\nvar _extends2 = _interopRequireDefault(require(\"@babel/runtime/helpers/extends\"));\n\nvar _utils = require(\"../core/utils\");\n\nfunction createWebStoragePersistor(_ref) {\n  var storage = _ref.storage,\n      _ref$key = _ref.key,\n      key = _ref$key === void 0 ? \"REACT_QUERY_OFFLINE_CACHE\" : _ref$key,\n      _ref$throttleTime = _ref.throttleTime,\n      throttleTime = _ref$throttleTime === void 0 ? 1000 : _ref$throttleTime,\n      _ref$serialize = _ref.serialize,\n      serialize = _ref$serialize === void 0 ? JSON.stringify : _ref$serialize,\n      _ref$deserialize = _ref.deserialize,\n      deserialize = _ref$deserialize === void 0 ? JSON.parse : _ref$deserialize;\n\n  //try to save data to storage\n  function trySave(persistedClient) {\n    try {\n      storage.setItem(key, serialize(persistedClient));\n    } catch (_unused) {\n      return false;\n    }\n\n    return true;\n  }\n\n  if (typeof storage !== 'undefined') {\n    return {\n      persistClient: throttle(function (persistedClient) {\n        if (trySave(persistedClient) !== true) {\n          var mutations = [].concat(persistedClient.clientState.mutations);\n          var queries = [].concat(persistedClient.clientState.queries);\n\n          var _client = (0, _extends2.default)({}, persistedClient, {\n            clientState: {\n              mutations: mutations,\n              queries: queries\n            }\n          }); // sort queries by dataUpdatedAt (oldest first)\n\n\n          var sortedQueries = [].concat(queries).sort(function (a, b) {\n            return a.state.dataUpdatedAt - b.state.dataUpdatedAt;\n          }); // clean old queries and try to save\n\n          var _loop = function _loop() {\n            var oldestData = sortedQueries.shift();\n            _client.clientState.queries = queries.filter(function (q) {\n              return q !== oldestData;\n            });\n\n            if (trySave(_client)) {\n              return {\n                v: void 0\n              }; // save success\n            }\n          };\n\n          while (sortedQueries.length > 0) {\n            var _ret = _loop();\n\n            if (typeof _ret === \"object\") return _ret.v;\n          } // clean mutations and try to save\n\n\n          while (mutations.shift()) {\n            if (trySave(_client)) {\n              return; // save success\n            }\n          }\n        }\n      }, throttleTime),\n      restoreClient: function restoreClient() {\n        var cacheString = storage.getItem(key);\n\n        if (!cacheString) {\n          return;\n        }\n\n        return deserialize(cacheString);\n      },\n      removeClient: function removeClient() {\n        storage.removeItem(key);\n      }\n    };\n  }\n\n  return {\n    persistClient: _utils.noop,\n    restoreClient: _utils.noop,\n    removeClient: _utils.noop\n  };\n}\n\nfunction throttle(func, wait) {\n  if (wait === void 0) {\n    wait = 100;\n  }\n\n  var timer = null;\n  var params;\n  return function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    params = args;\n\n    if (timer === null) {\n      timer = setTimeout(function () {\n        func.apply(void 0, params);\n        timer = null;\n      }, wait);\n    }\n  };\n}"],"names":["_interopRequireDefault","require","exports","__esModule","createWebStoragePersistor","_extends2","_utils","_ref","storage","_ref$key","key","_ref$throttleTime","throttleTime","_ref$serialize","serialize","JSON","stringify","_ref$deserialize","deserialize","parse","trySave","persistedClient","setItem","_unused","persistClient","throttle","mutations","concat","clientState","queries","_client","default","sortedQueries","sort","a","b","state","dataUpdatedAt","_loop","oldestData","shift","filter","q","v","length","_ret","restoreClient","cacheString","getItem","removeClient","removeItem","noop","func","wait","timer","params","_len","arguments","args","Array","_key","setTimeout","apply"],"mappings":"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"}